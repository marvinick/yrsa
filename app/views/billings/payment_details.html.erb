<div class="row text-center">
  <div class="col-md-12">
    <h1><%= link_to current_account.name, account_path(current_account) %></h1>
    <h4><%= current_account.owner.email %></h4>
  </div>
</div>

<div class="row text-center">
  <h3>payment detail</h3>

  <div class="col-md-6">
    <div class="billing">

      <%= form_tag account_update_payment_details_path(current_account), method: :put do %>
        <input type="hidden" id="email" value="<%= current_account.owner.email %> "/>
        <%= submit_tag "Update Payment Details", class: "btn btn-primary", id: "payment-btn" %>
        <%= link_to "cancel", account_path(current_account), class: "btn btn-lg btn-warning" %>
      <% end %>
    </div>
  </div>
  <div class="col-md-6"></div>
</div>


<script src="https://checkout.stripe.com/checkout.js"></script>
<script>
  $(document).ready(function () {
    var handler = StripeCheckout.configure({
      key: 'pk_test_tAEnFwxD4zPf5HKhTHfb17dC',
      image: 'https://stripe.com/img/documentation/checkout/marketplace.png',
      locale: 'auto',
      token: function(token) {
        $('form').append("<input type='hidden' name='token' value='" + token.id + "' />")
        $('form').submit();
      }
    });

    $('#payment-btn').on('click', function(e) {
      handler.open({
        name: 'Twist Books',
        currency: "aud",
        email: $('#email').val(),
        panelLabel: "Update payment details"
      });
      e.preventDefault();
    });

    // Close Checkout on page navigation
    $(window).on('popstate', function() {
      handler.close();
    });
  });
</script>
