<div class="row text-center">
  <div class="col-md-12">
    <h1><%= link_to current_account.name, account_path(current_account) %></h1>
  </div>
</div>

<%= simple_form_for(current_account, url: account_choose_plan_url) do |account| %>
  <% if current_account.stripe_subscription_id.blank? %>

    <% @plans.each do |plan| %>
      <% if plan.id == 3 %>
        <label class="big text-center">
          <%= account.radio_button :plan_id, plan.id, data: { behavior: "submit-on-click" }, class:"radiohidden"%>
          <h1><%= account.label "plan_id_#{plan.id}", plan.name %> (<%= money(plan.amount) %>)</h1> <br>
          <p>This is where you start</p>
        </label>
      <% end %>
    <% end %>

  <% else %>

    <% @plans.each do |plan| %>
      <% if current_account.over_limit_for?(plan) %>
        <% if plan.id == 2 %>
          <label class="big">
            <%= account.radio_button :plan_id, plan.id, data: { name: plan.name, amount: plan.amount}, disabled:"disabled" %>
            <%= account.label "plan_id_#{plan.id}", plan.name %>
            <%= money(plan.amount) %> <br>
          </label>
        <% elsif plan.id == 1 %>
          <label class="big">
            <%= account.radio_button :plan_id, plan.id, data: { name: plan.name, amount: plan.amount}, disabled:"disabled" %>
            <%= account.label "plan_id_#{plan.id}", plan.name %>
            <%= money(plan.amount) %> <br>
          </label>
        <% end %>
      <% else %>
        <% if plan.id == 2 %>
          <label class="big">
            <%= account.radio_button :plan_id, plan.id, data: { name: plan.name, amount: plan.amount} %>
            <%= account.label "plan_id_#{plan.id}", plan.name %>
            <%= money(plan.amount) %> <br>
          </label>
        <% elsif plan.id == 1 %>
          <label class="big">
            <%= account.radio_button :plan_id, plan.id, data: { name: plan.name, amount: plan.amount} %>
            <%= account.label "plan_id_#{plan.id}", plan.name %>
            <%= money(plan.amount) %> <br>
          </label>
        <% end %>
      <% end %>
    <% end %>

    <div id="payment-form"></div>
    <%= account.submit "Submit payment", class: "btn btn-primary btn-lg", id: "checkout-btn" %>
    <%= link_to "cancel", account_path(current_account), class: "btn btn-lg btn-warning" %>

  <% end %>

<% end %>

<script>
  $(document).on("click", "[data-behavior=submit-on-click]", function() {
    $form = $(this).closest('form'); // select the form
    $form.submit(); // submit it
  });
</script>
